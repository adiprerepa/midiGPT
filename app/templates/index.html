<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Tool</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
    }
    .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #333;
    }
    .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
        color: #fff;
    }
    .tab button:hover {
        background-color: #555;
    }
    .tab button.active {
        background-color: #f44336;
    }
    .tabcontent {
        display: none;
        flex-direction: column;
        padding: 20px;
        border: 1px solid #ccc;
        border-top: none;
        border-radius: 8px;
        background-color: #f9f9f9;
        box-shadow: 5px 5px 15px #e0e0e0, -5px -5px 15px #ffffff;
    }
    .row {
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        border: 1px solid black;
        border-radius: 8px;
        background-color: white;
        box-shadow: 5px 5px 15px #e0e0e0, -5px -5px 15px #ffffff;
    }
    .file-upload-button {
        display: inline-block;
        padding: 10px 20px;
        border: 2px solid #ccc;
        border-radius: 10px;
        background-color: #f9f9f9;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
        box-shadow: 3px 3px 5px #c9c9c9, -3px -3px 5px #ffffff;
    }
    .file-upload-button:hover {
        background-color: #f0f0f0;
        box-shadow: 3px 3px 5px #c9c9c9 inset, -3px -3px 5px #ffffff inset;
    }
    .generate-button {
        display: inline-block;
        padding: 10px 20px;
        border: 2px solid #f44336;
        border-radius: 10px;
        background-color: #f44336;
        cursor: pointer;
        transition: all 0.3s ease-in-out;
        color: #fff;
        font-weight: bold;
    }
    .generate-button:hover {
        background-color: #ff6659;
        border-color: #ff6659;
    }
    #GenerateMusic {background-color: lightblue;}
    #DetectWatermark {background-color: lightblue;}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>

<div class="tab">
    <button class="tablinks active" onclick="openTab(event, 'GenerateMusic')">Generate Music</button>
    <button class="tablinks" onclick="openTab(event, 'DetectWatermark')">Detect Watermark</button>
</div>
<!-- GENERATION CODE -->
<div id="GenerateMusic" class="tabcontent" style="display:block;">
    <h3>Upload wav for Music Generation</h3>
    <form action="/generate_music" method="POST" enctype="multipart/form-data">
        <label for="music_file">Upload WAV File:</label>
        <input type="file" id="music_file" name="music_file"><br>
        
        <label for="temperature">Temperature:</label>
        <input type="range" id="temperature" name="temperature" min="0" max="1" step="0.1" value="0.5">
        <span id="temperatureValue">0.5</span><br><br>

        <label for="max_tokens">Max Tokens:</label>
        <input type="range" id="max_tokens" name="max_tokens" min="4" max="100" value="50" step="4">
        <span id="maxTokensValue">50</span><br><br>

        <label for="tempo">Tempo:</label>
        <input type="range" id="tempo" name="tempo" min="0.5" max="2" step="0.1" value="1">
        <span id="tempoValue">1</span><br><br>

        <input type="submit" value="Generate and Detect" class="generate-button">
    </form>
    <p>Generated Music</p>
    <audio controls>
        <source src="./out/unwatermarked_generation.wav" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <p>Watermarked Music</p>
    <audio controls>
        <source src="./out/watermarked_generation.wav" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
    <div class="row">
        <audio id="generated_FilePlayer" controls style="margin-top: 20px; display: none;"></audio>
        <table id="table_generated_file">
            <tr>
                <th>Metric</th>
                <th>Value</th>
            </tr>
            {% for metric in metrics %}
            <tr>
                <td>{{ metric['name'] }}</td>
                <td>{{ metric['value'] }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    <div class="row">
        <audio id="generated_w_FilePlayer" controls style="margin-top: 20px; display: none;"></audio>
        <table id="table_w_generated_file">
            <tr>
                <th>Metric</th>
                <th>Value</th>
            </tr>
            {% for metric in w_metrics %}
            <tr>
                <td>{{ metric['name'] }}</td>
                <td>{{ metric['value'] }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
<!-- DETECTION CODE -->
<div id="DetectWatermark" class="tabcontent">
    <h3>Upload wav for Watermark Detection</h3>
    <label for="musicFile2" class="file-upload-button">Choose File</label>
    <form action="/detect_watermark" method="POST" enctype="multipart/form-data">
        <label for="music_file">Upload WAV File:</label>
        <input type="file" id="w_music_file" name="music_file"><br>
        <input type="submit" value="Detect Watermark" class="generate-button">
    </form>
    <meter id="confidenceMeter" min="0" max="1" value="0"></meter>
    <div class="row">
        <audio id="toDetect_FilePlayer" controls style="margin-top: 20px; display: none;"></audio>
        <table id="table_toDetect">
            <tr>
                <th>Metric</th>
                <th>Value</th>
            </tr>
            {% for metric in detect_metrics %}
            <tr>
                <td>{{ metric['name'] }}</td>
                <td>{{ metric['value'] }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>



<script>
    // Update slider values
    const temperatureSlider = document.getElementById('temperature');
    const temperatureValue = document.getElementById('temperatureValue');
    temperatureValue.innerHTML = temperatureSlider.value;
    temperatureSlider.oninput = function() {
        temperatureValue.innerHTML = this.value;
    };

    const maxTokensSlider = document.getElementById('max_tokens');
    const maxTokensValue = document.getElementById('maxTokensValue');
    maxTokensValue.innerHTML = maxTokensSlider.value;
    maxTokensSlider.oninput = function() {
        maxTokensValue.innerHTML = this.value;
    };

    const tempoSlider = document.getElementById('tempo');
    const tempoValue = document.getElementById('tempoValue');
    tempoValue.innerHTML = tempoSlider.value;
    tempoSlider.oninput = function() {
        tempoValue.innerHTML = this.value;
    };
    function openTab(evt, tabName) {
        var i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tabcontent");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
        }
        tablinks = document.getElementsByClassName("tablinks");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
    }
</script>

</body>
</html>
